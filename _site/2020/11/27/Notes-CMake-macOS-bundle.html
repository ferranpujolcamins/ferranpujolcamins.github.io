<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Some notes about generating a macOS bundle with CMake | Ferran Pujol Camins</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Some notes about generating a macOS bundle with CMake" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post post is just a bunch of incomplete notes. I found the information to be a bit disseminated and I thought it would be a good idea to put everything togheter in one place. You can find references to the sources." />
<meta property="og:description" content="This post post is just a bunch of incomplete notes. I found the information to be a bit disseminated and I thought it would be a good idea to put everything togheter in one place. You can find references to the sources." />
<link rel="canonical" href="http://localhost:4000/2020/11/27/Notes-CMake-macOS-bundle.html" />
<meta property="og:url" content="http://localhost:4000/2020/11/27/Notes-CMake-macOS-bundle.html" />
<meta property="og:site_name" content="Ferran Pujol Camins" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-27T00:00:00+01:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/11/27/Notes-CMake-macOS-bundle.html"},"headline":"Some notes about generating a macOS bundle with CMake","dateModified":"2020-11-27T00:00:00+01:00","datePublished":"2020-11-27T00:00:00+01:00","url":"http://localhost:4000/2020/11/27/Notes-CMake-macOS-bundle.html","description":"This post post is just a bunch of incomplete notes. I found the information to be a bit disseminated and I thought it would be a good idea to put everything togheter in one place. You can find references to the sources.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ferran Pujol Camins" /></head>
<body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Ferran Pujol Camins</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger"><a class="page-link" href="/resume/">Resume</a></div>
        </nav></div>
  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Some notes about generating a macOS bundle with CMake</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-11-27T00:00:00+01:00" itemprop="datePublished">Nov 27, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>This post post is just a bunch of incomplete notes. I found the information to be a bit disseminated and I thought it would be a good idea to put everything togheter in one place. You can find references to the sources.</p>

<p>At the moment of writing this I was using CMake and CPack 3.18.1.</p>

<h2 id="what-are-macos-bundles1">What are macOS bundles?<sup><a href="#ref-bundle-programming-guide">[1]</a></sup></h2>

<p>A bundle is just a directory with a specific structure that
contains executable code and the resources needed by that code.
The operating system treats such directories in special ways. For example, a macOS
app is a bundle (i.e. a directory). However, macOS presents the app
as a single unit, as it was a file, in order to prevent users to accidentally
modify important resources of the app and breaking it.</p>

<p>There are different <a href="https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFBundles/AboutBundles/AboutBundles.html#//apple_ref/doc/uid/10000123i-CH100-SW7">types of bundles</a>. Depending on its structure and contents
a bundle can be:</p>

<ul>
  <li>An application bundle</li>
  <li>A framework bundle</li>
  <li>A plug-in bundle</li>
</ul>

<p>For the task at hand we are only concerned about application bundles.</p>

<h3 id="structure-of-an-application-bundle11">Structure of an application bundle<sup><a href="#ref-application-bundles">[1.1]</a></sup></h3>
<p>A Mac app bundle has a simple basic structure: there’s a top-level directory named Contents. All the contents of the bundle are inside this directory, including the resources, executable code, private frameworks, private plug-ins and support files that the application needs.</p>

<p><strong>The basic structure of a macOS application</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MyApp.app/
   Contents/
      Info.plist
      MacOS/
      Resources/
</code></pre></div></div>

<p>The <em>Info.plist</em> file holds configuration information for the application. macOS looks into this file to gather relevant information about your application.</p>

<p>The <em>MacOS</em> directory contains the standalone executable code of the application. In most cases, this directory contains only one binary file: your application’s main executable. <strong>However, you can also put additional standalone executables (such as command-line tools) in this directory</strong>.</p>

<p>The <em>Resources</em> directory contains all of the application’s resource files. Resources are data files that live outside your application’s executable file like images, icons, sounds, strings files, configuration files, and data files (among others).</p>

<h3 id="the-infoplist2">The info.plist<sup><a href="#ref-information-property-list">[2]</a></sup></h3>
<p>To do.</p>

<h2 id="generating-a-bundle-with-cmake-and-cpack">Generating a bundle with CMake and CPack</h2>

<p><em>CPack</em> is a tool that helps creating installers or installation packages for our application
for each operating system we support.</p>

<p>Just like CMake has several <em>generators</em> to write the input files for several build systems,
CPack ha several <em>generators</em> to create different types of packages and installers
for different platforms<sup><a href="#ref-packaging-with-cpack">[3]</a></sup>.
There are two main generators for macOS bundles: the <em>DragNDrop</em> generator and the <em>Bundle</em> generator.</p>

<p>The <em>DragNDrop</em> generator does not allow multiple executables inside a single bundle; it enforces a 1:1 bundle-to-executable relationship.<sup><a href="#ref-drag-n-drop-package-generator">[4]</a></sup></p>

<p>The <em>Bundle</em> generator does support multiple executables inside a single bundle.</p>

<p>CPack is a standalone executable that reads a configuration file usually named <code class="language-plaintext highlighter-rouge">CPackConfig.cmake</code>.
However, CMake comes with a CPack module, which will automatically generate an
appropriate CPack configuration file<sup><a href="#ref-using-cpack-with-cmake">[3.1]</a></sup>.
The only thing we need to do to set it up is to include the module in our CMakeLists.txt:</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">include</span><span class="p">(</span>CPack<span class="p">)</span>
</code></pre></div></div>

<p>In order to use the CPack Bundle generator we need to define three CMake variables<sup><a href="#ref-cpack-bundle-generator">[5]</a></sup>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">CPACK_BUNDLE_NAME</code>: The bundle name</li>
  <li><code class="language-plaintext highlighter-rouge">CPACK_BUNDLE_ICON</code>: The bundle icon</li>
  <li><code class="language-plaintext highlighter-rouge">CPACK_BUNDLE_PLIST</code>: The bundle plist</li>
</ul>

<p>We must set these variables before we include CPack in order for them to take effect.</p>

<h2 id="references">References</h2>

<ol class="nestedList">
    <li>
        <span id="ref-bundle-programming-guide" class="ref">
            <a href="https://web.archive.org/web/20210118140759/https%3A%2F%2Fdeveloper.apple.com%2Flibrary%2Farchive%2Fdocumentation%2FCoreFoundation%2FConceptual%2FCFBundles%2FIntroduction%2FIntroduction.html">Bundle Programming Guide</a> <small>(developer.apple.com)</small>
        </span>
        <ol class="nestedList">
            <li>
                <span id="ref-application-bundles" class="ref">
                    <a href="https://web.archive.org/web/20210118141233/https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFBundles/BundleTypes/BundleTypes.html#//apple_ref/doc/uid/10000123i-CH101-SW13">Application Bundles</a>
                    
                </span>
            </li>
        </ol>
    </li>
        <li>
        <span id="ref-information-property-list" class="ref">
            <a href="https://web.archive.org/web/20210118142123/https://developer.apple.com/documentation/bundleresources/information_property_list">Information Property List</a> <small>(developer.apple.com)</small>
        </span>
    </li>
    <li>
        <span id="ref-packaging-with-cpack" class="ref">
            <a href="https://web.archive.org/web/20210118141434/https://gitlab.kitware.com/cmake/community/-/wikis/doc/cpack/Packaging-With-CPack">Packaging with CPack</a> <small>(gitlab.kitware.com/cmake)</small>
        </span>
        <ol class="nestedList">
            <li>
                <span id="ref-using-cpack-with-cmake" class="ref">
                    <a href="https://web.archive.org/web/20210118141434/https://gitlab.kitware.com/cmake/community/-/wikis/doc/cpack/Packaging-With-CPack#using-cpack-with-cmake">Using CPack with CMake</a>
                </span>
            </li>
        </ol>
    </li>
    <li>
        <span id="ref-drag-n-drop-package-generator" class="ref">
            <a href="https://web.archive.org/web/20210118141514/https://gitlab.kitware.com/cmake/community/-/wikis/doc/cpack/PackageGenerators#dragndrop-osx-only">DragNDrop Package generator</a> <small>(gitlab.kitware.com/cmake)</small>
        </span>
    </li>
    <li>
        <span id="ref-cpack-bundle-generator" class="ref">
            <a href="https://web.archive.org/web/20210118141717/https://cmake.org/cmake/help/git-stage/cpack_gen/bundle.html">CPack Bundle Generator</a>  <small>(cmake.org)</small>
        </span>
    </li>
    <li>
        <span class="ref">
            <a href="https://stackoverflow.com/a/44629910">MACOSX_BUNDLE vs CPACK_BUNDLE</a> <small>(stackoverflow.com)</small>
        </span>
    </li>
</ol>

  </div><a class="u-url" href="/2020/11/27/Notes-CMake-macOS-bundle.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ferran Pujol Camins</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ferran Pujol Camins</li><li><a class="u-email" href="mailto:me@ferranpujolcamins.cat">me@ferranpujolcamins.cat</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ferranpujolcamins"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ferranpujolcamins</span></a></li><li><a href="https://www.twitter.com/ferranpujolca"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ferranpujolca</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>I&#39;m a versatile software developer with a mathematics background who has developed his professional career as an iOS developer. I&#39;m now looking for new professional challenges as a C++ developer. I&#39;m comfortable solving new problems and learning new things. I&#39;ve contributed to several open source projects in different languages. I know C++, Rust and Swift, among other languages. My skills include mathematics, algorithmics, functional programming, category theory and basic electronics.
 </p>
      </div>
    </div>

    <div class="footer-license-wrapper">
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">ferranpujolcamins.cat</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.ferranpujolcamins.cat" property="cc:attributionName" rel="cc:attributionURL">Ferran Pujol Camins</a>.
        <br/>
        The content of this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        <br />
        Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/ferranpujolcamins/ferranpujolcamins.github.io" rel="dct:source">https://github.com/ferranpujolcamins/ferranpujolcamins.github.io</a>
    </div>

  </div>

</footer>
</body>

</html>
